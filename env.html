<!DOCTYPE html>
<html>
<head>
  <title>env (in requests) | Nodeca</title>
  <meta charset="utf-8">
  <meta name="generator" content="DocPad v6.78.4" />
  <link  rel="stylesheet" href="./styles/style.css" />
</head>
<body>
  <ul class='sidebar'>
    
      <li class="inactive">
        <a href="./app-files.html">App Files &amp; Dirs</a>
      </li>
    
      <li class="inactive">
        <a href="./app-bundler.html">Bundler</a>
      </li>
    
      <li class="inactive">
        <a href="./configs.html">Config files</a>
      </li>
    
      <li class="inactive">
        <a href="./cli-tools.html">CLI (console tools)</a>
      </li>
    
      <li class="inactive">
        <a href="./database.html">Database</a>
      </li>
    
      <li class="inactive">
        <a href="./n-structures.html">N.*</a>
      </li>
    
      <li class="inactive">
        <a href="./n-wire.html">N.wire (message bus)</a>
      </li>
    
      <li class="inactive">
        <a href="./n-live.html">N.live (realtime)</a>
      </li>
    
      <li class="inactive">
        <a href="./modules.html">Modules &amp; helpers</a>
      </li>
    
      <li class="inactive">
        <a href="./modules-server.html">Modules - Server</a>
      </li>
    
      <li class="inactive">
        <a href="./modules-client.html">Modules - Client</a>
      </li>
    
      <li class="inactive">
        <a href="./requests.html">HTTP/RPC requests</a>
      </li>
    
      <li class="active">
        <a href="./env.html">env (in requests)</a>
      </li>
    
      <li class="inactive">
        <a href="./router.html">Router</a>
      </li>
    
      <li class="inactive">
        <a href="./cookies.html">Cookies</a>
      </li>
    
      <li class="inactive">
        <a href="./models.html">Models</a>
      </li>
    
      <li class="inactive">
        <a href="./settings.html">Settings</a>
      </li>
    
      <li class="inactive">
        <a href="./menus.html">Menus</a>
      </li>
    
      <li class="inactive">
        <a href="./debugging.html">Debug</a>
      </li>
    
      <li class="inactive">
        <a href="./notifications.html">Notifications</a>
      </li>
    
      <li class="inactive">
        <a href="./testing.html">Testing</a>
      </li>
    
      <li class="inactive">
        <a href="./i18n.html">i18n</a>
      </li>
    
  </ul>
  <div class="content">
    <div class="page-header">
      <h1>env (in requests)</h1>
    </div>
    <p>Each request creates <code>env</code> object, that is piped via set of handlers. Env
contains all info about request and collects output data.</p>
<p>See current <code>env</code> structure below.</p>
<p><strong>NOTE</strong>. <code>env</code> should avoid functions, to be transparent for
server-server communications. But we have exclusion for <code>static</code> helpers</p>
<pre class="highlight"><code class="hljs no-highlight">env                     # `this` context of actions/filters

  method                # called method name (e.g.: ‘forum.posts.show’)
  params                # request params

  log_request           # internal, low-level logger for responders

  data                  # raw data sandbox (fetched db models and so on)

  err                   # internal, to pass error on finalization in responder
  status
  body                  # internal, used in responder end to prepare reply
  post: null            # internal, filled by formidable with `fields` &amp; `files`
                        # structures, for http POST requests

  headers               # http headers sandbox. (!) don&#39;t use `res` directly

  origin                # low-level data, rarely used, mostly to determine request type
    req                 # real server request and server response objects.
    res                 #

  session_id            # session id as hex-encoded string
  session               # session data
    ip
    token_csrf
    token_live
    user_id
    locale

  user_info             # some current user data, frequently used to process request
    hb                  # boolean, is user hell-banned
    locale              # current locale
    is_guest
    is_member
    user_id             # null for guest, hex string otherwise
    usergroups          # an array of object ids
    user_name
    user_hid
    user_avatar



  req                   # request details
    ip                  # request ip
    type                # responder type (http/rpc)
    isEncrypted         # is current request performed via https
    matched             # matched route cache, to avoid duplicate router call
    tzOffset            # client timezone offset for date helper (use server one by default)

  res                   # response sandbox:
    head                # (optional) { title: null }, data for html head
    menus               # (http only) static menus
    layout              # (http only) site layout
    settings            # (optional) settings/permissions

  t(name[, params])     # server-side Babelfish#t wrapper.
                        # uses right locale and prepends env.method to name.
  t.exists(name)

  helpers                   # helpers for view templates
    t(name[, params])       # babelfish.t proxy, without `language` param
    t.exists(name)
    apiPath                 # returns API path requested server method (‘forum.posts.show’)
    content                 # rendered part of page, for embedding into layout
    set_layout(name)        # allows to change default page layout
    link_to(name[, params]) # `N.runtime.route.linkTo` alias for templates
    asset_url(path)         # returns url for asset (wrapper over `N.asset.asset_url()`)
    asset_body(path)        # returns compiled asset as a string (wrapper
                            # over `N.asset.asset_body()`)
    date                    # date manipulation helper
    add_raw_data(key, val)  # add new key into `runtime.page_data` object (see below)

    # wrapper over `N.runtime.router.linkTo`
    # construts full url using current env for default protocol/host.
    # use `linkDefaults` object to specify protocol. (port will be detected)
    url_to(apiPath[, params[, linkDefaults]])

  extras                # shared storage for data (used for helpers)
    puncher()

    getCookie(name)                   # get value of input cookie, *not* output
    setCookie(name, value[, options]) # set output cookie

    settings            # optional sandbox for settings (permissions) fetch
      params            # required for fetch
      fetch()

  runtime               # data, injected into http page, used to pass variables
                        # for javascript (unused in rpc)
    layout
    token_csrf
    token_live

    locale
    user_name
    used_id             # &#39;000000000000000000000000&#39; for guest
    user_hid            # 0 for guest
    user_avatar         # avatar media id in filestore, or null for guest
    is_member
    is_guest

    page_data           # raw page data, for in-place rendering (by knockout,
                        # for example). Defined via `add_raw_data`
                        # helper in template

    recaptcha
</code></pre>

    <script defer="defer"  src="./vendor/jquery.js"></script><script defer="defer"  src="./scripts/script.js"></script>
  </div>
</body>
</html>
